(async () => {
  const supported = 'serviceWorker' in navigator;
  let regs = [];
  if (supported) {
    try {
      const list = await navigator.serviceWorker.getRegistrations();
      regs = list.map(r => r.active && r.active.scriptURL).filter(Boolean);
    } catch (e) {}
  }
  const controller = supported && navigator.serviceWorker.controller
    ? navigator.serviceWorker.controller.scriptURL
    : null;
  return JSON.stringify({ supported, controller, registrations: regs });
})();
