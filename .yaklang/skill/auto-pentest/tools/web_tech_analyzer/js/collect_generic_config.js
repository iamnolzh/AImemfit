(() => {
  const results = {
    globalVars: {},
    configObjects: {},
    routeConfigs: {},
    apiEndpoints: []
  };

  // 1. 检测所有$开头的全局变量（常见配置变量模式）
  Object.keys(window).forEach(key => {
    if (key.startsWith('$') && key.length > 1) {
      try {
        const val = window[key];
        if (val !== null && val !== undefined) {
          results.globalVars[key] = {
            type: typeof val,
            isObject: typeof val === 'object' && !Array.isArray(val),
            isArray: Array.isArray(val),
            sample: typeof val === 'string' ? val.slice(0, 100) :
                   typeof val === 'object' ? JSON.stringify(val).slice(0, 200) :
                   String(val).slice(0, 100)
          };
        }
      } catch (e) {}
    }
  });

  // 2. 检测可能的配置对象
  Object.keys(window).forEach(key => {
    if (key.startsWith('$') || key.includes('Config') || key.includes('CONFIG')) {
      try {
        const val = window[key];
        if (val && typeof val === 'object' && !Array.isArray(val) && !val.nodeType) {
          const keys = Object.keys(val);
          if (keys.length > 0 && keys.length < 50) { // 合理的配置对象大小
            results.configObjects[key] = {
              keys: keys.slice(0, 20),
              hasRoutes: keys.some(k => k.toLowerCase().includes('route')),
              hasApis: keys.some(k => k.toLowerCase().includes('api') || k.toLowerCase().includes('service')),
              hasMenus: keys.some(k => k.toLowerCase().includes('menu'))
            };
          }
        }
      } catch (e) {}
    }
  });

  // 3. 检测路由配置
  Object.keys(window).forEach(key => {
    try {
      const val = window[key];
      if (val && typeof val === 'object') {
        if (key.toLowerCase().includes('route') && Array.isArray(val)) {
          results.routeConfigs[key] = val.map(r =>
            typeof r === 'object' ? (r.path || r.name || JSON.stringify(r).slice(0, 50)) : String(r)
          ).slice(0, 20);
        }
      }
    } catch (e) {}
  });

  // 4. 从脚本和DOM中提取可能的API端点模式
  try {
    const scripts = Array.from(document.scripts);
    const apiPatterns = [
      /\/api\/[^'"\s]+/g,
      /https?:\/\/[^'"\s]+\/api\/[^'"\s]*/g,
      /['"`]\/[^'"\s]*service[^'"\s]*['"`]/g
    ];

    scripts.forEach(script => {
      if (script.textContent) {
        apiPatterns.forEach(pattern => {
          const matches = script.textContent.match(pattern);
          if (matches) {
            results.apiEndpoints.push(...matches.slice(0, 10));
          }
        });
      }
    });

    // 从DOM属性中提取
    ['action', 'href', 'src', 'data-url', 'data-api'].forEach(attr => {
      document.querySelectorAll(`[${attr}]`).forEach(el => {
        const val = el.getAttribute(attr);
        if (val && (val.includes('/api/') || val.includes('service'))) {
          results.apiEndpoints.push(val);
        }
      });
    });

    // 去重
    results.apiEndpoints = [...new Set(results.apiEndpoints)].slice(0, 50);
  } catch (e) {}

  return JSON.stringify(results);
})();