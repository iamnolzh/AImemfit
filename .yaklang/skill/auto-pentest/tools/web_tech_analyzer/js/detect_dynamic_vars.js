(() => {
  const results = {
    dollarVars: [],
    underscoreVars: [],
    configLikeVars: [],
    routerVars: [],
    apiVars: []
  };

  // 检测所有window上的变量
  const allKeys = Object.keys(window);

  allKeys.forEach(key => {
    try {
      const val = window[key];

      // 1. $开头的变量
      if (key.startsWith('$')) {
        results.dollarVars.push({
          name: key,
          type: typeof val,
          value: typeof val === 'object' ? '[Object]' :
                 typeof val === 'function' ? '[Function]' :
                 String(val).slice(0, 50)
        });
      }

      // 2. __开头的变量
      if (key.startsWith('__')) {
        results.underscoreVars.push({
          name: key,
          type: typeof val,
          value: typeof val === 'object' ? '[Object]' :
                 typeof val === 'function' ? '[Function]' :
                 String(val).slice(0, 50)
        });
      }

      // 3. 可能包含配置的对象
      if (typeof val === 'object' && val !== null && !Array.isArray(val) && !val.nodeType) {
        const objKeys = Object.keys(val);

        // 路由相关
        if (objKeys.some(k => k.toLowerCase().includes('route') || k.toLowerCase().includes('path'))) {
          results.routerVars.push({
            name: key,
            keys: objKeys.slice(0, 10),
            sampleValues: objKeys.slice(0, 3).map(k => ({ [k]: String(val[k]).slice(0, 30) }))
          });
        }

        // API相关
        if (objKeys.some(k => k.toLowerCase().includes('api') || k.toLowerCase().includes('service') || k.toLowerCase().includes('endpoint'))) {
          results.apiVars.push({
            name: key,
            keys: objKeys.slice(0, 10),
            sampleValues: objKeys.slice(0, 3).map(k => ({ [k]: String(val[k]).slice(0, 30) }))
          });
        }

        // 通用配置对象
        if (objKeys.length > 2 && objKeys.length < 100 &&
            !key.startsWith('_') &&
            !['document', 'window', 'navigator', 'location', 'history'].includes(key)) {
          results.configLikeVars.push({
            name: key,
            keyCount: objKeys.length,
            sampleKeys: objKeys.slice(0, 5),
            hasNestedObjects: objKeys.some(k => typeof val[k] === 'object' && val[k] !== null)
          });
        }
      }

    } catch (e) {
      // 忽略访问出错的变量
    }
  });

  // 限制结果大小
  Object.keys(results).forEach(category => {
    if (Array.isArray(results[category])) {
      results[category] = results[category].slice(0, 20);
    }
  });

  return JSON.stringify(results);
})();