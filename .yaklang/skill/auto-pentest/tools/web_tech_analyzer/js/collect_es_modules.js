(() => {
  const modules = Array.from(document.querySelectorAll('script[type="module"]'))
    .map(s => ({ src: s.src || null, inline: !s.src, textSample: !s.src ? s.textContent.trim().slice(0,200) : null }));
  const importmaps = Array.from(document.querySelectorAll('script[type="importmap"]'))
    .map(s => ({ textSample: s.textContent.trim().slice(0,500) }));
  return JSON.stringify({ modules, importmaps });
})();
