(() => {
  // 快速测试脚本 - 验证框架基本功能
  const test = {
    timestamp: new Date().toISOString(),
    url: window.location.href,
    title: document.title,
    results: {}
  };

  // 测试1: 基础检测
  try {
    test.results.basic = {
      hasScripts: document.scripts.length > 0,
      hasLinks: document.links.length > 0,
      hasForms: document.forms.length > 0,
      hasImages: document.images.length > 0
    };
  } catch (e) {
    test.results.basic = { error: e.message };
  }

  // 测试2: 框架检测
  try {
    test.results.frameworks = {
      vue: !!(window.Vue || window.__VUE_DEVTOOLS_GLOBAL_HOOK__ || document.querySelector('[data-v-]')),
      react: !!(window.__REACT_DEVTOOLS_GLOBAL_HOOK__ || document.querySelector('[data-reactroot], [data-reactid]')),
      angular: !!(window.ng || document.querySelector('[ng-version]')),
      jquery: !!(window.jQuery || window.$),
      axios: !!window.axios,
      fetch: typeof window.fetch === 'function'
    };
  } catch (e) {
    test.results.frameworks = { error: e.message };
  }

  // 测试3: 全局变量统计
  try {
    const globals = Object.keys(window);
    test.results.globals = {
      total: globals.length,
      dollarVars: globals.filter(k => k.startsWith('$')).length,
      underscoreVars: globals.filter(k => k.startsWith('__')).length,
      sampleKeys: globals.slice(0, 10)
    };
  } catch (e) {
    test.results.globals = { error: e.message };
  }

  // 测试4: 资源统计
  try {
    test.results.resources = {
      scripts: document.scripts.length,
      externalScripts: Array.from(document.scripts).filter(s => s.src).length,
      inlineScripts: Array.from(document.scripts).filter(s => !s.src).length,
      stylesheets: document.styleSheets.length,
      links: document.links.length,
      forms: document.forms.length
    };
  } catch (e) {
    test.results.resources = { error: e.message };
  }

  // 测试5: 网络能力检测
  try {
    test.results.network = {
      fetch: typeof window.fetch === 'function',
      xmlhttprequest: typeof window.XMLHttpRequest === 'function',
      websocket: typeof window.WebSocket === 'function',
      serviceWorker: 'serviceWorker' in navigator,
      webgl: (() => {
        try {
          const canvas = document.createElement('canvas');
          return !!(canvas.getContext('webgl') || canvas.getContext('experimental-webgl'));
        } catch (e) { return false; }
      })()
    };
  } catch (e) {
    test.results.network = { error: e.message };
  }

  // 给出建议
  test.recommendations = [];

  if (test.results.frameworks?.vue) test.recommendations.push('建议执行: vue_routes.js 分析Vue路由');
  if (test.results.frameworks?.react) test.recommendations.push('建议执行: react_routes.js 分析React路由');
  if (test.results.frameworks?.axios) test.recommendations.push('建议执行: hook_network.js 拦截网络请求');
  if (test.results.globals?.dollarVars > 0) test.recommendations.push('建议执行: collect_runtime_config.js 分析配置变量');
  if (test.results.resources?.inlineScripts > 0) test.recommendations.push('建议执行: collect_inline.js 分析内联脚本');

  if (test.recommendations.length === 0) {
    test.recommendations.push('建议执行: collect_all.js 进行综合分析');
  }

  return JSON.stringify(test, null, 2);
})();